<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ccr.mapper.AnnouncementMapper">

    <sql id="BaseResult">
        select id, title, content, announcement_type, priority, publisher_id, publisher_name, publish_time, start_time, end_time, read_count, status, create_time, update_time, create_user, update_user, is_deleted
        from announcement
    </sql>

    <insert id="addAnnouncement">
        insert into announcement
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="title != null and title != ''">title,</if>
            <if test="content != null and content != ''">content,</if>
            <if test="announcementType != null">announcement_type,</if>
            <if test="priority != null">priority,</if>
            <if test="publisherId != null">publisher_id,</if>
            <if test="publisherName != null and publisherName != ''">publisher_name,</if>
            <if test="publishTime != null">publish_time,</if>
            <if test="startTime != null">start_time,</if>
            <if test="endTime != null">end_time,</if>
            <if test="status != null">status,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="createUser != null">create_user,</if>
            <if test="updateUser != null">update_user,</if>
            is_deleted,
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="title != null and title != ''">#{title},</if>
            <if test="content != null and content != ''">#{content},</if>
            <if test="announcementType != null">#{announcementType},</if>
            <if test="priority != null">#{priority},</if>
            <if test="publisherId != null">#{publisherId},</if>
            <if test="publisherName != null and publisherName != ''">#{publisherName},</if>
            <if test="publishTime != null">#{publishTime},</if>
            <if test="startTime != null">#{startTime},</if>
            <if test="endTime != null">#{endTime},</if>
            <if test="status != null">#{status},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="createUser != null">#{createUser},</if>
            <if test="updateUser != null">#{updateUser},</if>
            0,
        </trim>
    </insert>
    <update id="updateAnnouncement">
        update announcement
        <set>
            <if test="title != null and title != ''">title = #{title},</if>
            <if test="content != null and content != ''">content = #{content},</if>
            <if test="announcementType != null">announcement_type = #{announcementType},</if>
            <if test="priority != null">priority = #{priority},</if>
            <if test="startTime != null">start_time = #{startTime},</if>
            <if test="endTime != null">end_time = #{endTime},</if>
            <if test="status != null">status = #{status},</if>
            <if test="readCount != null">read_count = #{readCount},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="updateUser != null">update_user = #{updateUser},</if>
        </set>
        where id = #{id} and is_deleted = 0
    </update>

    <update id="deleteAnnouncement">
        update announcement
        set is_deleted = 1
        where id in
        <foreach item="item" collection="list" separator="," open="(" close=")">
            #{item}
        </foreach>
    </update>
    <select id="getAnnouncementDetails" resultType="com.ccr.entity.Announcement">
        <include refid="BaseResult"/>
        where id = #{id} and is_deleted = 0
    </select>
    <select id="page" resultType="com.ccr.vo.AnnouncementPageVO">
        <include refid="BaseResult"/>
        <where>
            <if test="title != null and title != ''">and title like concat('%', #{title}, '%')</if>
            <if test="announcementType != null">and announcement_type = #{announcementType}</if>
            <if test="publisherName != null and publisherName != ''">and publisher_name like concat('%', #{publisherName}, '%')</if>
            <if test="status != null">and status = #{status}</if>
            and is_deleted = 0
        </where>
        order by priority desc, create_time desc
    </select>
    <select id="getAnnouncementWithReadCount" resultType="com.ccr.entity.Announcement">
        select id,read_count from announcement
        where id = #{id} and is_deleted = 0
    </select>
</mapper>